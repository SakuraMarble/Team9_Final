# 阶段2：完善游戏逻辑和联机网络逻辑

> DDL：2023-05-02

## 任务
###分工
~~（分配比较随缘，问题不大）~~
* 游戏逻辑部分：
1. 马博靖：优化倒计时更加界面友好，对局结束显示结算信息；
2. 祝凯：保存对局信息并且实现基本复现，围棋路数设置；
3. 李雨城：高亮上一步的棋子，濒死提示；
* 联机逻辑部分：++（在此处给出参考分工，但由于这个板块是上一步不做好，下一步难以进行，所以不用特别死扣，按照下文联机逻辑部分的红字处理）++
1. 祝凯：实现客户端向服务端发起连接、实现发起对局；
2. 马博靖：实现联机对战通信、实现联机再来一局；
3. 李雨城：实现聊天；++（李雨城同学可以继续优化AI代码，解决AI上一阶段出现的问题，比如“有点呆”、“有点卡”，考虑是否要使用多进程解决问题）++
* 有多的时间：
1. 实现逐步复现；
2. 美化UI；
3. 提前开启下一阶段；
4. 实现联机其他路棋盘的协议补充；

### 游戏逻辑部分

1. 显示倒计时**++（已完成，等优化：需要放大，更明显，更好看）++**
2. 对局结束后显示结算信息**++（在mouseRelease函数中记录，并且存入vector容器。每次初始化游戏要重置）++**
3. 保存对局信息到本地，并且可以用这段编码复现对局**++（“退出程序”或者“手动点击保存对局信息”或者“游戏结束”，把对局信息存储到本地。在模式选择界面加入导入对局选项（可以继续游戏的那种），点击该选项后可以选择一个本地文件，按照一定的编码逻辑读取该文件，并且一步一步复现对局（点击Next显示下一步），此功能需要用到文件操作）++**<font color=red>呃，助教要求的是实现呈现最终对局就好，有时间再去实现上述功能吧。</font>
4. 实现高亮对手或自己最近一步下在哪**++（如果我在思考，只需要高亮标记对方的上一步棋子就好，关于如何高亮可以思考一下，比如改一下边框颜色？如果对方在思考，只用标记我刚刚下的棋子就好++）**
5. 实现 11, 13 路不围棋**++（这个改成可设置的选项即可，下文提到，只需要实现<font color=red>本地即可</font>）++**
6. 实现濒死提示：你应当禁止玩家走会输的步（自杀，吃对方），通过例如禁止点击，或二次提示。**++（在isLose判断中加入二次提示，如果执意要下我们也不拦着）++**

**结算信息**：
- 获胜方
- 步数：为了一致，认输也算一步，比如"A1 B1 认输"算3步
- 其他自定，比如平均思考时间，游戏总时间等

> 你也可以把结算信息中的一部分或全部常驻在界面上。

**对局信息**:
统一编码成 "`A1 B2 E9 G`" 这样，以空格为分隔符，结尾不含多余的空格。**其中 `G` 表示认输**。

**复现**: 只要展示最终局面即可**<font color=red>（如果后面有能力可以尝试实现一步一步复现的操作，并且可以随时终止复现，接着下棋）</font>**

**其他路数棋盘**：
只需要实现本地游戏即可，不要求实现联机，因此也没有对应的协议提供，如果你们愿意，可以自己补充。

### 联机逻辑部分
<font color=red>这一部分不太熟悉，具体的安排不好做，建议就是边学边做，学会了的就直接去做就好了，谁先做出来就是谁负责（但是要求就是，各个接口不要弄乱了，一定要写好注释，不然后续有人想接着做就不知道从何入手）</font>
1. 实现客户端向服务端发起连接
2. 实现发起对局，接受和拒绝对局
3. 实现联机对战通信
4. 实现联机再来一局
5. 实现聊天

你需要用 `network/` 下的通信协议和通信接口来完成联机设计，更具体地，这个邀请机制类似于：被申请对局者收到 `READY_OP` 后会弹出“xxx(执黑)想和你(执白)对局 接受 拒绝”。

**设计要求**

- 你不应该把客户端和服务端显式地分开（比如进入游戏时选择要进入服务端or客户端），应该同时管理二者，用户既可以向任意 `IP:PROT` 发起对局，并等待对方接受，也可以收到其他人发来的对局申请，而不会感知到自己进了两种模式。
- `IP` 和 `端口` 不应该硬编码，而应该是软件内可修改的。
- 这一阶段，你可以假设在一次软件打开中，服务端只会被一个客户端连接，客户端也只会尝试连接一次一个服务端，不会既要被申请，又要发送申请，只会发生其中之一，任何时候都可以利用“重启软件”。但不满足这些条件是第三阶段的附加任务之一。

## 提交

无论你是否在截止时间前完成这一阶段的全部开发任务，请在 `submission/` 下你的小组文件夹中上传你第二阶段的阶段性报告，在报告中请简要描述你的小组分工、代码框架设计、遇到的问题及解决方法和其他你认为有必要的内容。
